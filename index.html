<!DOCTYPE html>
<html>
<head>
  <title>卡片分享中心</title>
  <meta charset="UTF-8">
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h3>正在準備分享卡片...</h3>
  <script>
    async function main() {
      await liff.init({ liffId: "2007303884-g2wdGNQ4" });

      const urlParams = new URLSearchParams(window.location.search);
      const type = urlParams.get("type");

      if (!type) {
        alert("缺少類型參數，請從機器人按正確的分享按鈕進來");
        window.close();
        return;
      }

      let flexMsg = null;

      // ------------------------ GigaFile分享系統 ------------------------
      if (type === "gigafile") {
        const filename = urlParams.get("filename");
        const filesize = urlParams.get("filesize");
        const deadline = urlParams.get("deadline");
        const fileurl = urlParams.get("url");

        if (!filename || !filesize || !deadline || !fileurl) {
          alert("缺少GigaFile參數，請從正確按鈕進來");
          window.close();
          return;
        }

        flexMsg = {
          type: "flex",
          altText: "GigaFile 影片",
          contents: {
            type: "bubble",
            hero: {
              type: "image",
              url: "https://i.imgur.com/suPTpBm.jpeg",
              size: "full",
              aspectRatio: "16:9",
              aspectMode: "cover"
            },
            body: {
              type: "box",
              layout: "vertical",
              spacing: "sm",
              contents: [
                {
                  type: "text",
                  text: filename,
                  weight: "bold",
                  size: "md",
                  wrap: true
                },
                {
                  type: "text",
                  text: "大小：" + filesize,
                  size: "sm",
                  color: "#666666",
                  wrap: true
                },
                {
                  type: "text",
                  text: "有效期限：" + deadline,
                  size: "sm",
                  color: "#666666",
                  wrap: true
                }
              ]
            },
            footer: {
              type: "box",
              layout: "vertical",
              spacing: "sm",
              contents: [
                {
                  type: "button",
                  style: "primary",
                  height: "sm",
                  action: {
                    type: "uri",
                    label: "點進網頁",
                    uri: fileurl
                  }
                },
                {
                  type: "button",
                  style: "secondary",
                  height: "sm",
                  action: {
                    type: "uri",
                    label: "分享給親友",
                    uri: liff.permanentLink.createUrl()
                  }
                }
              ],
              flex: 0
            }
          }
        };
      }
      // ------------------------ 以後新增別的分享系統（範例） ------------------------
      else if (type === "gift") {
        const title = urlParams.get("title") || "神秘禮物";
        const img = urlParams.get("img") || "https://i.imgur.com/your_default_image.jpg";

        flexMsg = {
          type: "flex",
          altText: "禮物來囉！",
          contents: {
            type: "bubble",
            hero: {
              type: "image",
              url: img,
              size: "full",
              aspectRatio: "1:1",
              aspectMode: "cover"
            },
            body: {
              type: "box",
              layout: "vertical",
              contents: [
                {
                  type: "text",
                  text: title,
                  weight: "bold",
                  size: "xl",
                  align: "center"
                }
              ]
            }
          }
        };
      }
      // ------------------------ 沒有對應的分享類型 ------------------------
else if (type === "gas") {
    const update = urlParams.get("update") || "未知";
    const time = urlParams.get("time") || "未知";
    const change = urlParams.get("change") || "無資料";
    const p92 = urlParams.get("p92") || "N/A";
    const p95 = urlParams.get("p95") || "N/A";
    const p98 = urlParams.get("p98") || "N/A";
    const alcohol = urlParams.get("alcohol") || "N/A";
    const diesel = urlParams.get("diesel") || "N/A";
    const gas = urlParams.get("gas") || "N/A";

    const shareUrl = liff.permanentLink.createUrl();  // 建立自己的 LIFF 分享網址

    flexMsg = {
        type: "flex",
        altText: "油價資訊分享",
        contents: {
            type: "bubble",
            size: "mega",
            body: {
                type: "box",
                layout: "vertical",
                spacing: "sm",
                contents: [
                    { type: "text", text: "【油價資訊】", weight: "bold", size: "xl", margin: "md" },
                    { type: "text", text: `公告日期：${update}`, size: "sm", color: "#888888" },
                    { type: "text", text: `更新時間：${time}`, size: "sm", color: "#888888" },
                    { type: "text", text: `調整幅度：${change}`, size: "sm", color: "#d0021b" },
                    { type: "separator", margin: "md" },
                    {
                        type: "box",
                        layout: "vertical",
                        spacing: "sm",
                        margin: "md",
                        contents: [
                            { type: "text", text: `92無鉛：${p92} 元`, size: "md" },
                            { type: "text", text: `95無鉛：${p95} 元`, size: "md" },
                            { type: "text", text: `98無鉛：${p98} 元`, size: "md" },
                            { type: "text", text: `酒精汽油：${alcohol} 元`, size: "md" },
                            { type: "text", text: `超級柴油：${diesel} 元`, size: "md" },
                            { type: "text", text: `液化石油氣：${gas} 元`, size: "md" }
                        ]
                    },
                    { type: "separator", margin: "md" },
                    {
                        type: "button",
                        style: "primary",
                        height: "sm",
                        action: {
                            type: "uri",
                            label: "分享油價卡片",
                            uri: shareUrl
                        }
                    }
                ]
            }
        }
    };
}
      // ------------------------ 分享卡片 ------------------------
      if (liff.isApiAvailable('shareTargetPicker') && flexMsg) {
        await liff.shareTargetPicker([flexMsg]);
        liff.closeWindow();
      } else {
        alert("此裝置不支援分享功能或Flex格式錯誤");
      }
    }

    main();
  </script>
</body>
</html>
